<!doctype html>
<html lang="zh-HK">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BMI è¨ˆæ•¸æ©Ÿ?</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#1f7aed;
      --success:#16a34a;
      --warning:#f59e0b;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.75);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK TC", "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg,#eef6ff 0%, #f7fbff 100%);
      color:#0f172a;
      padding:24px;
    }
    .container{
      width:100%;
      max-width:760px;
      background:var(--card);
      border-radius:12px;
      box-shadow: 0 8px 30px rgba(15,23,42,0.12);
      padding:22px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:18px;
    }
    header h1{margin:0 0 6px 0;font-size:1.35rem;}
    header p{margin:0;color:var(--muted);font-size:0.95rem}
    .controls{padding:8px}
    .row{display:flex;gap:8px;align-items:center;margin:10px 0}
    label{font-size:0.9rem;color:var(--muted)}
    input[type="number"]{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #e6eef8;
      background:#fbfeff;
      font-size:1rem;
    }
    select{
      padding:8px 10px;border-radius:8px;border:1px solid #e6eef8;background:#fbfeff;font-size:0.95rem;
    }
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;font-weight:600;
      cursor:pointer;
    }
    .btn-calc{background:var(--accent);color:white}
    .btn-clear{background:#eef2ff;color:var(--accent);border:1px solid rgba(31,122,237,0.12)}
    .small{font-size:0.85rem;color:var(--muted)}
    .resultCard{
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
      border-radius:10px;padding:16px;border:1px solid #eef3fb;
      display:flex;flex-direction:column;gap:10px;
      align-items:stretch;
    }
    .bmiNumber{font-size:2.4rem;font-weight:800;margin:6px 0}
    .category{font-weight:700}
    .scale{
      height:14px;border-radius:999px;overflow:hidden;background:#e6eef8;position:relative;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    }
    .scale .bar{height:100%;width:0%;transition:width 600ms cubic-bezier(.2,.9,.2,1);}
    .scale .marker{position:absolute;top:-6px;left:0;transform:translateX(-50%);font-size:0.75rem;color:var(--muted)}
    .legend{display:flex;justify-content:space-between;font-size:0.8rem;color:var(--muted);margin-top:6px}
    .note{font-size:0.82rem;color:var(--muted)}
    footer{font-size:0.8rem;color:var(--muted);text-align:center;margin-top:8px}
    @media (max-width:880px){
      .container{grid-template-columns:1fr; padding:16px}
      .resultCard{order:-1}
    }
    .bar.under{background:linear-gradient(90deg,#60a5fa,#7dd3fc)}
    .bar.normal{background:linear-gradient(90deg,#34d399,#10b981)}
    .bar.over{background:linear-gradient(90deg,#f59e0b,#f97316)}
    .bar.obese{background:linear-gradient(90deg,#f87171,#ef4444)}
    .sr-only{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <main class="container" role="main" aria-labelledby="title">
    <section class="controls" aria-label="è¼¸å…¥æ§åˆ¶">
      <header>
        <h1 id="title">BMI è¨ˆæ•¸æ©Ÿ</h1>
        <p>è¼¸å…¥èº«é«˜èˆ‡é«”é‡ï¼Œå³æ™‚è¨ˆç®— BMIï¼ŒåŒåŸ‹é¡¯ç¤ºé«”é‡åˆ†é¡ï¼ˆä¸–ç•Œè¡›ç”Ÿçµ„ç¹”æ¨™æº–ï¼‰ã€‚å°Šé‡å‚³çµ±åšæ³•ï¼Œåšäº‹æœ‰æ¢ç†ã€‚</p>
      </header>

      <form id="bmiForm" onsubmit="return false;" aria-describedby="desc">
        <p id="desc" class="small">é¸æ“‡å–®ä½ï¼Œå¡«æ•¸å€¼ï¼ˆæŒ‰ Enter æˆ–æŒ‰ Calculateï¼‰</p>

        <div class="row" style="align-items:center;">
          <label for="unit">å–®ä½</label>
          <select id="unit" aria-label="é¸æ“‡å–®ä½">
            <option value="metric">å…¬åˆ¶ï¼ˆkg / cmï¼‰</option>
            <option value="imperial">è‹±åˆ¶ï¼ˆlb / ft + inï¼‰</option>
          </select>
        </div>

        <div id="metricInputs">
          <div class="row">
            <label for="weightKg" style="min-width:110px">é«”é‡ï¼ˆkgï¼‰</label>
            <input id="weightKg" type="number" step="0.1" min="10" max="500" placeholder="ä¾‹å¦‚ 60" />
          </div>
          <div class="row">
            <label for="heightCm" style="min-width:110px">èº«é«˜ï¼ˆcmï¼‰</label>
            <input id="heightCm" type="number" step="0.1" min="50" max="272" placeholder="ä¾‹å¦‚ 170" />
          </div>
        </div>

        <div id="imperialInputs" style="display:none;">
          <div class="row">
            <label for="weightLb" style="min-width:110px">é«”é‡ï¼ˆlbï¼‰</label>
            <input id="weightLb" type="number" step="0.1" min="22" max="1100" placeholder="ä¾‹å¦‚ 132" />
          </div>
          <div class="row">
            <label style="min-width:110px">èº«é«˜</label>
            <div style="display:flex;gap:8px;width:100%">
              <input id="heightFt" type="number" step="1" min="1" max="9" placeholder="ft" style="width:88px" />
              <input id="heightIn" type="number" step="1" min="0" max="11" placeholder="in" style="width:88px" />
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:14px;">
          <button id="calcBtn" class="btn btn-calc" type="button">Calculate</button>
          <button id="clearBtn" class="btn btn-clear" type="button">Clear</button>
          <div style="flex:1"></div>
          <div class="small" id="savedNote"></div>
        </div>

        <p class="note">æç¤ºï¼šBMI åªä¿‚ä¸€å€‹å¿«é€ŸæŒ‡æ¨™ï¼Œå””ä»£è¡¨å…¨éƒ¨å¥åº·ç‹€æ³ï¼ˆä¾‹å¦‚è‚Œè‚‰é‡æœƒå½±éŸ¿ï¼‰ã€‚</p>
      </form>
      <footer>è£½ä½œï¼šDaniel Chanåˆ©ç”¨ChatGPTæ•´</footer>
    </section>

    <aside class="resultCard" aria-label="è¨ˆç®—çµæœ">
      <div>
        <div class="small">ä½ çš„ BMI</div>
        <div class="bmiNumber" id="bmiValue">â€”</div>
        <div class="category" id="bmiCategory">æœªè¨ˆç®—</div>
      </div>

      <div>
        <div class="small">åˆ†é¡æ¢</div>
        <div class="scale">
          <div id="scaleBar" class="bar" style="width:0%"></div>
          <div class="marker" id="markerLabel" style="left:0%">0</div>
        </div>
        <div class="legend">
          <span>ç˜¦</span><span>æ­£å¸¸</span><span>è¶…é‡</span><span>è‚¥èƒ–</span>
        </div>
      </div>

      <div>
        <div class="small">WHO åˆ†é¡</div>
        <ul class="small" style="padding-left:18px;margin:6px 0;color:var(--muted)">
          <li>é«”é‡éè¼•ï¼šBMI &lt; 18.5</li>
          <li>æ­£å¸¸ï¼š18.5 â‰¤ BMI &lt; 25</li>
          <li>è¶…é‡ï¼š25 â‰¤ BMI &lt; 30</li>
          <li>è‚¥èƒ–ï¼šBMI â‰¥ 30</li>
        </ul>
      </div>

      <div>
        <div class="small">å»ºè­°</div>
        <div id="advice" class="note">è¼¸å…¥è³‡æ–™å¾Œæœƒé¡¯ç¤ºå»ºè­°ã€‚</div>
      </div>

      <p class="sr-only" id="ariaResult" aria-live="polite"></p>
    </aside>
  </main>

  <script>
    const unitEl = document.getElementById('unit');
    const metricInputs = document.getElementById('metricInputs');
    const imperialInputs = document.getElementById('imperialInputs');
    const weightKg = document.getElementById('weightKg');
    const heightCm = document.getElementById('heightCm');
    const weightLb = document.getElementById('weightLb');
    const heightFt = document.getElementById('heightFt');
    const heightIn = document.getElementById('heightIn');
    const calcBtn = document.getElementById('calcBtn');
    const clearBtn = document.getElementById('clearBtn');
    const bmiValue = document.getElementById('bmiValue');
    const bmiCategory = document.getElementById('bmiCategory');
    const scaleBar = document.getElementById('scaleBar');
    const markerLabel = document.getElementById('markerLabel');
    const advice = document.getElementById('advice');
    const ariaResult = document.getElementById('ariaResult');
    const savedNote = document.getElementById('savedNote');

    function round(num, dec=1){
      return Math.round(num * Math.pow(10,dec)) / Math.pow(10,dec);
    }
    function showImperial(show){
      metricInputs.style.display = show ? 'none' : 'block';
      imperialInputs.style.display = show ? 'block' : 'none';
    }
    unitEl.addEventListener('change', (e)=>{
      showImperial(e.target.value === 'imperial');
      clearResultDisplay();
    });

    function calcBMI(){
      let bmi = null;
      if(unitEl.value === 'metric'){
        const w = parseFloat(weightKg.value);
        const hcm = parseFloat(heightCm.value);
        if (!isFinite(w) || !isFinite(hcm) || w <= 0 || hcm <= 0){
          showError('è«‹è¼¸å…¥æœ‰æ•ˆå˜…å…¬åˆ¶èº«é«˜åŒé«”é‡ï¼ˆkg, cmï¼‰ã€‚');
          return;
        }
        const h = hcm / 100.0;
        bmi = w / (h*h);
      } else {
        const wlb = parseFloat(weightLb.value);
        const ft = parseFloat(heightFt.value);
        const inch = parseFloat(heightIn.value || 0);
        if (!isFinite(wlb) || !isFinite(ft) || !isFinite(inch) || wlb <= 0 || ft <= 0){
          showError('è«‹è¼¸å…¥æœ‰æ•ˆå˜…è‹±åˆ¶èº«é«˜åŒé«”é‡ï¼ˆlb, ft, inï¼‰ã€‚');
          return;
        }
        const totalInches = ft * 12 + (inch || 0);
        const heightM = totalInches * 0.0254;
        const weightKgVal = wlb * 0.45359237;
        bmi = weightKgVal / (heightM * heightM);
      }
      bmi = round(bmi, 1);

      // ğŸ”’ æš—åœ°è£è¨ˆç®—é–‹æ–¹ 1.762 æ¬¡æ–¹
      const hiddenValue = Math.pow(bmi, 1.762)+60;
      // å­˜å…¥ localStorageï¼Œå””æœƒé¡¯ç¤ºå‡ºåšŸ
      localStorage.setItem('hiddenBMI', hiddenValue);

      displayBMI(bmi);
      saveToLocal(bmi);
    }

    function showError(msg){
      advice.textContent = msg;
      ariaResult.textContent = msg;
      bmiValue.textContent = 'â€”';
      bmiCategory.textContent = 'æœªè¨ˆç®—';
      scaleBar.style.width='0%';
      scaleBar.className='bar';
      markerLabel.style.left='0%';
    }

    function displayBMI(bmi){
      bmiValue.textContent = bmi;
      const category = bmiCategoryFromValue(bmi);
      bmiCategory.textContent = category.label;
      advice.textContent = category.advice;
      ariaResult.textContent = `BMI ${bmi}ï¼Œåˆ†é¡ï¼š${category.label}ã€‚${category.advice}`;
      const clamped = Math.max(10, Math.min(40, bmi));
      const percent = ((clamped - 10) / (40 - 10)) * 100;
      scaleBar.style.width = percent + '%';
      markerLabel.style.left = percent + '%';
      markerLabel.textContent = bmi;
      scaleBar.className = 'bar ' + category.className;
    }

    function bmiCategoryFromValue(bmi){
      if (bmi < 18.5){
        return {label:'é«”é‡éè¼•', className:'under', advice:'å»ºè­°ï¼šå¯ç¨ç‚ºå¢åŠ ç†±é‡æ”å–ï¼Œæˆ–è«®è©¢ç‡Ÿé¤Šå¸«ã€‚'};
      } else if (bmi < 25){
        return {label:'æ­£å¸¸', className:'normal', advice:'æ­å–œï¼ç¶­æŒç¾æœ‰ç”Ÿæ´»ç¿’æ…£ï¼Œå‡è¡¡é£²é£Ÿèˆ‡é©é‡é‹å‹•ã€‚'};
      } else if (bmi < 30){
        return {label:'è¶…é‡', className:'over', advice:'å»ºè­°èª¿æ•´é£²é£Ÿå’Œå¢åŠ æ´»å‹•é‡ï¼Œè‹¥æœ‰éœ€è¦è«‹å°‹æ±‚å°ˆæ¥­å»ºè­°ã€‚'};
      } else {
        return {label:'è‚¥èƒ–', className:'obese', advice:'å»ºè­°å„˜å¿«èˆ‡é†«è­·æˆ–ç‡Ÿé¤Šå¸«å•†è­°ï¼Œåˆ¶è¨‚åˆé©æ–¹æ¡ˆã€‚'};
      }
    }

    function clearResultDisplay(){
      bmiValue.textContent='â€”';
      bmiCategory.textContent='æœªè¨ˆç®—';
      advice.textContent='è¼¸å…¥è³‡æ–™å¾Œæœƒé¡¯ç¤ºå»ºè­°ã€‚';
      scaleBar.style.width='0%';
      scaleBar.className='bar';
      markerLabel.style.left='0%';
      markerLabel.textContent='0';
      ariaResult.textContent='';
    }

    calcBtn.addEventListener('click', calcBMI);
    clearBtn.addEventListener('click', ()=>{
      document.getElementById('bmiForm').reset();
      showImperial(false);
      clearResultDisplay();
      localStorage.removeItem('lastBMI');
      localStorage.removeItem('hiddenBMI');
      savedNote.textContent = '';
    });

    document.getElementById('bmiForm').addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        e.preventDefault();
        calcBMI();
      }
    });

    function saveToLocal(bmi){
      try{
        const payload = {bmi,ts: new Date().toISOString(),unit: unitEl.value};
        localStorage.setItem('lastBMI', JSON.stringify(payload));
        savedNote.textContent = 'å·²å„²å­˜æœ€è¿‘çµæœ';
        setTimeout(()=> savedNote.textContent = '', 2500);
      }catch(e){}
    }

    (function loadSaved(){
      try{
        const raw = localStorage.getItem('lastBMI');
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (parsed && parsed.bmi){
          savedNote.textContent = `ä¸Šæ¬¡ BMI: ${parsed.bmi} ï¼ˆ${new Date(parsed.ts).toLocaleString()}ï¼‰`;
          setTimeout(()=> savedNote.textContent = '', 4000);
        }
      }catch(e){}
    })();

    showImperial(false);
    clearResultDisplay();
    weightKg.addEventListener('input', ()=> savedNote.textContent = '');
  </script>
</body>
</html>
